openapi: 3.0.3
info:
  title: Ktor testiipii api
  description: testiipii
  version: 1.0.0

servers:
  - url: http://localhost:8080/
    description: Testiipii server

paths:
  /:
    get:
      tags:
        - Root
      summary: Root endpoint
      description: Simple health check endpoint
      responses:
        '200':
          description: Returns "Hello World!"
          content:
            text/plain:
              schema:
                type: string
                example: "Hello World!"

  /authentication/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user with email and password to receive JWT tokens
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Successfully authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /authentication/refresh-token:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Obtain new access token using valid refresh token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Tokens refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /authentication/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Logout user and invalidate JWT token
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully logged out
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users:
    post:
      tags:
        - Users
      summary: Create new user
      description: Register a new user in the system
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Users
      summary: Get users list
      description: Retrieve paginated list of users
      operationId: getUsers
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default 1)
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of users per page (default 10)
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: Retrieve specific user details by user ID
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Users
      summary: Update user
      description: Update user information (requires authentication)
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Users
      summary: Delete user
      description: Delete user account (requires authentication)
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products:
    get:
      tags:
        - Products
      summary: Get products list
      description: Retrieve list of products with optional name filter
      operationId: getProducts
      parameters:
        - name: name
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductResponse'

    post:
      tags:
        - Products
      summary: Create new product
      description: Create a new product (requires authentication)
      operationId: createProduct
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{id}:
    get:
      tags:
        - Products
      summary: Get product by ID
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Products
      summary: Update product
      description: Update product (requires authentication)
      operationId: updateProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Products
      summary: Delete product
      description: Delete product (requires authentication)
      operationId: deleteProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders:
    post:
      tags:
        - Orders
      summary: Create new order
      description: Create a new order with products (requires authentication)
      operationId: createOrder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

    get:
      tags:
        - Orders
      summary: Get user orders
      description: Retrieve all orders for the authenticated user
      operationId: getUserOrders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderResponse'

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order by ID
      description: Retrieve order by ID (requires authentication)
      operationId: getOrderById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Orders
      summary: Update order
      description: Update existing order (requires authentication)
      operationId: updateOrder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Orders
      summary: Delete order
      description: Delete order (requires authentication)
      operationId: deleteOrder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login or refresh endpoints

  schemas:
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Operation completed successfully"

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          description: Error description
          example: "Invalid credentials"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "student@university.edu"
        password:
          type: string
          format: password
          description: User's password
          example: "securePassword123"
      example:
        email: "student@university.edu"
        password: "securePassword123"

    RefreshTokenRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh token received during login
          example: "123:abc123def-4567-8901-2345-6789abcdef01"
      example:
        refresh_token: "123:abc123def-4567-8901-2345-6789abcdef01"

    AuthResponse:
      type: object
      required:
        - access_token
        - refresh_token
      properties:
        access_token:
          type: string
          description: JWT access token for authenticated requests
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiZXhwIjoxNjAwMDAwMDAwfQ.example"
        refresh_token:
          type: string
          description: Refresh token to obtain new access tokens
          example: "123:abc123def-4567-8901-2345-6789abcdef01"

    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          description: User's full name
          example: "John Doe"
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: User's email address
          example: "john.doe@university.edu"
        password:
          type: string
          format: password
          description: User's password
          example: "securePassword123"
          minLength: 6
      example:
        name: "John Doe"
        email: "john.doe@university.edu"
        password: "securePassword123"

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          description: User's full name
          example: "John Updated"
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: User's email address
          example: "john.updated@university.edu"
      example:
        name: "John Updated"
        email: "john.updated@university.edu"

    UserResponse:
      type: object
      properties:
        id:
          type: integer
          description: User ID
          example: 123
        name:
          type: string
          description: User's full name
          example: "John Doe"
        email:
          type: string
          format: email
          description: User's email address
          example: "john.doe@university.edu"
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
          example: "2023-12-07T10:30:00Z"

    CreateProductRequest:
      type: object
      required:
        - name
        - description
        - price
      properties:
        name:
          type: string
          description: Product name
          example: "Laptop"
          minLength: 1
          maxLength: 100
        description:
          type: string
          description: Product description
          example: "High-performance laptop for students"
          maxLength: 500
        price:
          type: number
          format: double
          description: Product price
          example: 999.99
          minimum: 0.01
      example:
        name: "Laptop"
        description: "High-performance laptop for students"
        price: 999.99

    UpdateProductRequest:
      type: object
      properties:
        name:
          type: string
          description: Product name
          example: "Updated Laptop"
          minLength: 1
          maxLength: 100
        description:
          type: string
          description: Product description
          example: "Updated description"
          maxLength: 500
        price:
          type: number
          format: double
          description: Product price
          example: 899.99
          minimum: 0.01
      example:
        name: "Updated Laptop"
        description: "Updated description"
        price: 899.99

    ProductResponse:
      type: object
      properties:
        id:
          type: integer
          description: Product ID
          example: 1
        name:
          type: string
          description: Product name
          example: "Laptop"
        description:
          type: string
          description: Product description
          example: "High-performance laptop for students"
        price:
          type: number
          format: double
          description: Product price
          example: 999.99
        createdAt:
          type: string
          format: date-time
          description: Product creation timestamp
          example: "2023-12-07T10:30:00Z"

    OrderItemRequest:
      type: object
      required:
        - productId
        - quantity
      properties:
        productId:
          type: integer
          description: Product ID
          example: 1
          minimum: 1
        quantity:
          type: integer
          description: Product quantity
          example: 2
          minimum: 1
      example:
        productId: 1
        quantity: 2

    CreateOrderRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          description: List of order items
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderItemRequest'
      example:
        items:
          - productId: 1
            quantity: 2
          - productId: 3
            quantity: 1

    UpdateOrderRequest:
      type: object
      properties:
        items:
          type: array
          description: Updated list of order items (if provided, replaces all existing items)
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderItemRequest'
      example:
        items:
          - productId: 1
            quantity: 3
          - productId: 2
            quantity: 1

    OrderItemResponse:
      type: object
      properties:
        productId:
          type: integer
          description: Product ID
          example: 1
        name:
          type: string
          description: Product name
          example: "Laptop"
        quantity:
          type: integer
          description: Product quantity in order
          example: 2
        price:
          type: number
          format: double
          description: Product price at time of order
          example: 999.99

    OrderResponse:
      type: object
      properties:
        id:
          type: integer
          description: Order ID
          example: 1
        userId:
          type: integer
          description: User ID who created the order
          example: 123
        totalPrice:
          type: number
          format: double
          description: Total order price
          example: 1999.98
        items:
          type: array
          description: Order items
          items:
            $ref: '#/components/schemas/OrderItemResponse'
        createdAt:
          type: string
          format: date-time
          description: Order creation timestamp
          example: "2023-12-07T10:30:00Z"